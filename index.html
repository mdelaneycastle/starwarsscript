<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flickity Swipe Gallery</title>
    <!-- Flickity CSS -->
    <link rel="stylesheet" href="https://unpkg.com/flickity@2/dist/flickity.min.css">
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #111;
            color: #000;
        }
        .gallery-container {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .carousel {
            height: 80%;
            background: #dadada;
        }
        .carousel-cell {
            width: 70%;
            height: 100%;
            margin-right: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        .carousel-cell img {
            max-width: 100%;
            max-height: 100%;
        }
        .thumbnail-bar {
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #222;
            padding: 10px;
        }
        .thumbnail-bar img {
            height: 60px;
            margin: 0 5px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border 0.3s;
        }
        .thumbnail-bar img.active {
            border-color: #f00;
        }
    </style>
</head>
<body>
    <div class="gallery-container">
        <div class="carousel" id="carousel"></div>
        <div class="thumbnail-bar" id="thumbnailBar"></div>
    </div>

    <!-- Flickity JavaScript -->
    <script src="https://unpkg.com/flickity@2/dist/flickity.pkgd.min.js"></script>
    <script>
        const carouselElement = document.getElementById('carousel');
        const thumbnailBar = document.getElementById('thumbnailBar');

        // Fetch image list from the server
        fetch('./list-images.php')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to fetch image list');
                }
                return response.json();
            })
            .then(images => {
                images.forEach((file, index) => {
                    const imagePath = `./Images/${file}`;
                    
                    const carouselCell = document.createElement('div');
                    carouselCell.classList.add('carousel-cell');
                    carouselCell.innerHTML = `<img src="${imagePath}" alt="Image ${index + 1}">`;
                    carouselElement.appendChild(carouselCell);

                    const thumbnail = document.createElement('img');
                    thumbnail.src = imagePath;
                    thumbnail.alt = `Thumbnail ${index + 1}`;
                    thumbnail.setAttribute('data-index', index);
                    thumbnailBar.appendChild(thumbnail);
                });

                initializeFlickity();
            })
            .catch(error => console.error('Error loading images:', error));

        function initializeFlickity() {
            // Initialize Flickity
            const flkty = new Flickity('.carousel', {
                cellAlign: 'center',
                contain: true,
                wrapAround: true,
                autoPlay: 3000,
                prevNextButtons: true,
                pageDots: false,
                draggable: true,
                dragThreshold: 2,
                groupCells: false
            });

            const thumbnails = Array.from(thumbnailBar.children);

            // Update active thumbnail when the slider changes
            flkty.on('select', () => {
                thumbnails.forEach((thumbnail, index) => {
                    thumbnail.classList.toggle('active', index === flkty.selectedIndex);
                });
            });

            // Add click event to thumbnails
            thumbnails.forEach((thumbnail, index) => {
                thumbnail.addEventListener('click', () => {
                    flkty.select(index);
                });
            });
        }
    </script>
</body>
</html>
