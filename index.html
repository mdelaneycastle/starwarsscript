<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Image Viewer with Splide.js</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@splidejs/splide@3.6.11/dist/css/splide.min.css">
  <style>
    @font-face {
      font-family: 'Starjedi';
      src: url('./fonts/Starjedi.ttf') format('truetype');
    }

    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #dadada;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
      flex-direction: column;
    }

    .splide {
      width: 80%;
      margin-bottom: 20px;
    }

    .splide__slide img {
      width: 100%;
      height: auto;
      object-fit: contain;
      max-height: 60vh;
      transition: all 0.3s ease-in-out;
      cursor: pointer;
    }

    #thumbnail-slider .splide__slide img {
      width: 120px;
      height: 90px;
      object-fit: cover;
      border-radius: 5px;
      border: 2px solid transparent;
      transition: border 0.2s;
    }

    #thumbnail-slider .splide__slide.is-active img {
      border-color: #007bff;
    }

    #image-title {
      font-size: 1.5rem;
      color: #333;
      text-align: center;
      font-family: 'Starjedi', Arial, sans-serif;
      text-transform: lowercase;
    }

    /* Modal Styles */
    #image-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.9);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    #image-modal img {
      max-width: 90%;
      max-height: 90%;
      transform: scale(1);
      transition: transform 0.3s ease;
    }

    #image-modal .close {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 2rem;
      color: white;
      cursor: pointer;
    }

    #image-modal .zoom {
      position: absolute;
      bottom: 20px;
      font-size: 1.2rem;
      color: white;
      display: flex;
      gap: 15px;
    }

    #image-modal .zoom button {
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      font-size: 1.5rem;
    }
  </style>
</head>
<body>
  <!-- Main Slider -->
  <div id="main-slider" class="splide">
    <div class="splide__track">
      <ul class="splide__list">
        <!-- Main images will be dynamically injected here -->
      </ul>
    </div>
  </div>

  <!-- Thumbnail Slider -->
  <div id="thumbnail-slider" class="splide">
    <div class="splide__track">
      <ul class="splide__list">
        <!-- Thumbnails will be dynamically injected here -->
      </ul>
    </div>
  </div>

  <!-- Image Title -->
  <div id="image-title">Title</div>

  <!-- Image Modal -->
  <div id="image-modal">
    <span class="close">&times;</span>
    <img src="" alt="Full Image">
    <div class="zoom">
      <button id="zoom-in">+</button>
      <button id="zoom-out">-</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@splidejs/splide@3.6.11/dist/js/splide.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      fetch('images.json')
        .then(response => response.json())
        .then(images => {
          const mainList = document.querySelector('#main-slider .splide__list');
          const thumbnailList = document.querySelector('#thumbnail-slider .splide__list');
          const imageTitle = document.getElementById('image-title');
          const modal = document.getElementById('image-modal');
          const modalImg = modal.querySelector('img');
          const closeModal = modal.querySelector('.close');
          const zoomIn = document.getElementById('zoom-in');
          const zoomOut = document.getElementById('zoom-out');

          let scale = 1;

          const extractTitle = (filename) =>
            filename.slice(2).replace(/_1\.jpg$/, '').replace(/_/g, "'").toLowerCase();

          // Populate sliders
          images.forEach(image => {
            const mainSlide = document.createElement('li');
            mainSlide.classList.add('splide__slide');
            const mainImg = document.createElement('img');
            mainImg.src = `Images/${image}`;
            mainImg.alt = extractTitle(image);

            mainSlide.appendChild(mainImg);
            mainList.appendChild(mainSlide);

            const thumbnailSlide = document.createElement('li');
            thumbnailSlide.classList.add('splide__slide');
            const thumbnailImg = document.createElement('img');
            thumbnailImg.src = `Thumbnails/${image}`;
            thumbnailImg.alt = extractTitle(image);
            thumbnailSlide.appendChild(thumbnailImg);
            thumbnailList.appendChild(thumbnailSlide);
          });

          // Initialize sliders
          const mainSlider = new Splide('#main-slider', {
            type: 'fade',
            heightRatio: 0.5,
            pagination: false,
            arrows: false,
            cover: true,
          });

          const thumbnailSlider = new Splide('#thumbnail-slider', {
            fixedWidth: 120,
            fixedHeight: 90,
            isNavigation: true,
            gap: 10,
            focus: 'center',
            pagination: false,
            cover: true,
          });

          mainSlider.sync(thumbnailSlider).mount();
          thumbnailSlider.mount();

          // Update title and add click event to the visible main image
          const updateMainImageClick = () => {
            const activeImage = document.querySelector(
              '#main-slider .splide__slide.is-active img'
            );

            if (activeImage) {
              console.log('Active image found:', activeImage.src); // Debug log

              // Remove existing event listeners by replacing the image element
              const newImage = activeImage.cloneNode(true);
              activeImage.parentNode.replaceChild(newImage, activeImage);

              // Attach the click event listener to the active image
              newImage.addEventListener('click', () => {
                console.log('Main image clicked! Opening modal...'); // Debug log
                modal.style.display = 'flex'; // Open the modal
                modalImg.src = newImage.src; // Set the modal image source
                scale = 1; // Reset zoom
                modalImg.style.transform = `scale(${scale})`;
              });
            } else {
              console.log('No active image found.'); // Debug log
            }
          };

          mainSlider.on('mounted move', index => {
            imageTitle.textContent = extractTitle(images[index]);
            updateMainImageClick();
          });

          // Set initial title and enable click
          imageTitle.textContent = extractTitle(images[0]);
          updateMainImageClick();

          // Modal functionality
          closeModal.addEventListener('click', () => {
            console.log('Close button clicked!'); // Debug log
            modal.style.display = 'none';
          });

          modal.addEventListener('click', (e) => {
            if (e.target === modal) {
              console.log('Modal background clicked!'); // Debug log
              modal.style.display = 'none';
            }
          });

          zoomIn.addEventListener('click', () => {
            scale += 0.2;
            modalImg.style.transform = `scale(${scale})`;
          });

          zoomOut.addEventListener('click', () => {
            scale = Math.max(1, scale - 0.2);
            modalImg.style.transform = `scale(${scale})`;
          });

          // Test if the modal works independently
          document.body.addEventListener('click', (e) => {
            if (e.target.closest('#main-slider')) return; // Prevent triggering when clicking unrelated areas
            modal.style.display = 'flex'; // Open the modal manually
            modalImg.src = 'Images/01The Star Wars_1.jpg'; // Replace with a valid image path
            console.log('Modal triggered independently!'); // Debug log
          });
        });
    });
  </script>
</body>
</html>
